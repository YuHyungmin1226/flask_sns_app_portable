# Flask SNS 포터블 앱 🚀

USB에 복사하여 어디서든 실행할 수 있는 개인 SNS 애플리케이션입니다.

## ✨ 주요 기능

-   **사용자 관리**:
    -   **회원가입 및 로그인/로그아웃**: 고유한 사용자 이름과 비밀번호로 회원가입하고, 안전하게 로그인 및 로그아웃할 수 있습니다.
    -   **프로필 보기**: 자신의 프로필과 다른 사용자의 프로필을 방문하여 작성된 게시물을 확인할 수 있습니다.
    -   **비밀번호 변경**: 로그인한 사용자는 현재 비밀번호 확인 후 새 비밀번호로 변경할 수 있습니다.
-   **게시물 관리**:
    -   **게시물 작성**: 로그인한 사용자는 새로운 텍스트 게시물을 작성할 수 있습니다.
    -   **URL 미리보기**: 게시물에 URL이 포함된 경우, `requests` 및 `beautifulsoup4`를 사용하여 자동으로 제목, 설명, 이미지를 포함한 풍부한 미리보기를 생성합니다. YouTube 링크에 대해서는 특별히 썸네일을 추출합니다.
    -   **게시물 조회**: 메인 피드에서 모든 게시물을 볼 수 있으며, 개별 게시물을 클릭하여 상세 내용을 확인할 수 있습니다.
    -   **게시물 삭제**: 게시물 작성자 또는 관리자는 게시물을 삭제할 수 있습니다.
-   **댓글 시스템**:
    -   **댓글 작성**: 모든 게시물에 댓글을 작성할 수 있습니다.
    -   **댓글 삭제**: 댓글 작성자 또는 관리자는 댓글을 삭제할 수 있습니다.
-   **관리자 기능**:
    -   **사용자 목록 관리**: 관리자 권한을 가진 사용자는 모든 등록된 사용자 목록을 확인하고 관리할 수 있습니다.
    -   **사용자 삭제**: 관리자는 비관리자 사용자 계정을 삭제할 수 있습니다.
-   **포터블 환경 지원**:
    -   **SQLite 데이터베이스**: 외부 데이터베이스 서버 설정 없이 파일 기반의 `sns.db`를 사용하여 애플리케이션의 높은 휴대성을 보장합니다. PyInstaller로 빌드된 실행 파일에서도 데이터가 영구적으로 유지되도록 `instance` 폴더를 실행 파일 옆에 생성하도록 설정되었습니다.
    -   **자동 포트 탐색**: `FlaskSNS.py` 실행 시 5001번 포트부터 시작하여 사용 가능한 포트를 자동으로 찾아 애플리케이션을 실행합니다.
    -   **Waitress WSGI 서버**: 순수 Python으로 구현된 `waitress` WSGI 서버를 사용하여 별도의 웹 서버 없이도 애플리케이션을 실행할 수 있습니다.
-   **한국 시간 지원**: 모든 시간 관련 기능은 한국 표준시(KST)를 따릅니다.

## 🚀 시작하기

### 1. 실행 방법

-   **Python 스크립트로 실행**:
    -   `python FlaskSNS.py` 명령어를 입력하여 실행합니다.
-   **PyInstaller로 빌드된 실행 파일로 실행**:
    -   `dist` 폴더 내의 `FlaskSNS.exe` 파일을 직접 실행합니다.

### 2. 접속

-   **URL**: http://localhost:5001 (기본 포트 5001이 사용 중일 경우, 자동으로 다른 사용 가능한 포트를 찾아 실행됩니다.)
-   **기본 계정**: admin / admin123 (첫 실행 시 자동 생성됩니다. 로그인 후 프로필에서 변경을 권장합니다.)
-   **네트워크 접속**: http://[IP주소]:[포트] (같은 네트워크 내에서 다른 기기로 접속 가능)

### 3. PyInstaller 빌드 및 포터블 실행 파일 생성

이 애플리케이션은 PyInstaller를 사용하여 단일 실행 파일(`FlaskSNS.exe`)로 빌드될 수 있습니다. 이 과정에서 데이터 지속성 및 템플릿 로딩 문제를 해결하기 위한 특별한 설정이 적용되었습니다.

**빌드 명령:**
```bash
pyinstaller FlaskSNS.py --onefile --clean --distpath dist --add-data "templates;templates"
```
*   `--onefile`: 모든 종속성을 포함하는 단일 실행 파일을 생성합니다.
*   `--clean`: 빌드 전에 임시 파일과 캐시를 정리하여 깨끗한 빌드를 보장합니다.
*   `--distpath dist`: 생성된 실행 파일을 `dist` 폴더에 저장합니다.
*   `--add-data "templates;templates"`: `templates` 폴더와 그 내용을 실행 파일 내부에 포함시킵니다. 이는 Flask가 템플릿 파일을 찾을 수 있도록 하는 데 필수적입니다.

**핵심 해결책:**
PyInstaller로 빌드된 환경에서 Flask 애플리케이션이 `sns.db` 파일과 HTML 템플릿 파일을 올바르게 찾지 못하는 문제를 해결하기 위해 `app.py` 파일에 다음과 같은 로직이 추가되었습니다:
*   **`instance` 폴더 및 `sns.db` 지속성:**
    *   애플리케이션이 PyInstaller로 번들링된 경우, `FlaskSNS.exe` 파일이 위치한 디렉토리를 기준으로 `instance` 폴더를 생성하도록 `Flask` 앱의 `instance_path`를 명시적으로 설정했습니다. 이로 인해 `sns.db` 파일은 실행 파일 옆의 `instance` 폴더 내에 저장되어 데이터가 영구적으로 유지됩니다.
*   **템플릿 파일 로딩:**
    *   번들링된 환경에서는 `sys._MEIPASS` (PyInstaller가 파일을 압축 해제하는 임시 디렉토리) 내의 `templates` 폴더를 `Flask` 앱의 `template_folder`로 명시적으로 지정했습니다. `--add-data` 옵션과 함께 이 설정은 Flask가 모든 HTML 템플릿을 올바르게 찾을 수 있도록 합니다.

### 4. USB 사용

1.  `dist` 폴더 내의 `FlaskSNS.exe` 파일과 함께 생성된 `instance` 폴더(최초 실행 시 자동 생성)를 USB에 복사합니다.
2.  USB를 다른 PC에 연결합니다.
3.  USB 드라이브에서 `FlaskSNS.exe`를 실행합니다.
4.  브라우저에서 접속합니다.

**주의사항:**
*   **쓰기 권한:** USB 드라이브에 `FlaskSNS.exe`가 있는 폴더에 쓰기 권한이 있어야 `instance` 폴더와 `sns.db` 파일이 생성되고 데이터가 저장될 수 있습니다.
*   **성능:** USB 드라이브의 속도에 따라 애플리케이션의 성능이 영향을 받을 수 있습니다. 빠른 USB 드라이브 사용을 권장합니다.

## 📁 폴더 구조

```
FlaskSNS/
├── FlaskSNS.py          # 메인 실행 파일: 애플리케이션 시작, 데이터베이스 초기화, 포트 탐색 및 Waitress WSGI 서버 실행
├── app.py               # 핵심 Flask 애플리케이션: 앱 설정, 데이터베이스 모델(User, Post, Comment), 모든 라우트(인증, 게시물, 댓글, 관리자), 보안 로직 구현
├── requirements.txt     # Python 패키지 목록
├── templates/           # Jinja2 HTML 템플릿 파일들
│   ├── base.html        # 모든 페이지의 기본 레이아웃 및 공통 UI 요소
│   ├── index.html       # 메인 페이지: 게시물 목록 표시
│   ├── _posts_list.html # 게시물 목록을 렌더링하는 부분 템플릿 (무한 스크롤에 사용)
│   ├── login.html       # 사용자 로그인 폼
│   ├── register.html    # 사용자 회원가입 폼
│   ├── new_post.html    # 새 게시물 작성 폼
│   ├── view_post.html   # 단일 게시물 상세 보기 및 댓글 작성 폼
│   ├── profile.html     # 사용자 프로필 및 해당 사용자의 게시물 목록
│   ├── change_password.html # 비밀번호 변경 폼
│   └── admin.html       # 관리자 페이지: 사용자 목록 및 관리 기능
├── utils/               # 유틸리티 함수 모음
│   └── url_utils.py     # URL 미리보기 생성 로직 구현
├── instance/            # Flask 애플리케이션 인스턴스 관련 파일 (예: sns.db)
│   └── sns.db           # SQLite 데이터베이스 파일 (애플리케이션 실행 시 자동 생성 및 관리)
└── README.md            # 이 프로젝트에 대한 설명 파일
```

## 💾 데이터 저장

모든 데이터는 실행 파일과 같은 폴더 내의 `instance` 하위 폴더에 있는 `sns.db` 파일에 저장됩니다.

### 🔄 데이터 백업 및 복원

**백업 방법:**
1.  `instance` 폴더 전체를 복사

**복원 방법:**
1.  백업한 `instance` 폴더를 앱 실행 파일이 있는 폴더에 복사
2.  앱 재실행

## 🔧 시스템 요구사항

-   **OS**: Windows 10/11, macOS, Linux
-   **Python**: 3.8 이상
-   **메모리**: 최소 512MB
-   **저장공간**: 최소 100MB

## 📦 필요한 패키지

이 프로젝트는 다음 Python 패키지들을 사용합니다. `pip install -r requirements.txt` 명령어로 설치할 수 있습니다.

-   **Flask**: 웹 애플리케이션 개발을 위한 마이크로 웹 프레임워크.
-   **Flask-SQLAlchemy**: Flask 애플리케이션에서 SQLAlchemy를 쉽게 사용할 수 있도록 돕는 확장. 데이터베이스 ORM(Object Relational Mapper) 기능을 제공합니다.
-   **Flask-Login**: 사용자 세션 관리, 로그인/로그아웃 및 '로그인 상태 유지' 기능을 처리하는 Flask 확장.
-   **requests**: 외부 URL의 콘텐츠를 가져오는 데 사용되는 HTTP 라이브러리. `url_utils.py`에서 URL 미리보기 생성에 활용됩니다.
-   **beautifulsoup4**: HTML 및 XML 문서를 파싱하여 데이터를 추출하는 라이브러리. `url_utils.py`에서 웹 페이지의 메타데이터를 분석하는 데 사용됩니다.
-   **waitress**: 프로덕션 환경에서 Flask 애플리케이션을 안정적으로 서빙하기 위한 순수 Python WSGI 서버. `FlaskSNS.py`에서 애플리케이션 실행에 사용됩니다.
-   **SQLAlchemy**: Python SQL 툴킷 및 ORM. Flask-SQLAlchemy의 기반이 되는 라이브러리입니다.
-   **pytz**: 시간대 데이터베이스를 제공하여 한국 표준시(KST)와 같은 시간대 처리에 사용됩니다.
-   **werkzeug.security**: 비밀번호 해싱 및 검증(`generate_password_hash`, `check_password_hash`)과 같은 보안 관련 유틸리티를 제공합니다.
-   **WTForms**: `requirements.txt`에 포함되어 있으나, 현재 `app.py` 내에서 폼 렌더링이나 유효성 검사에 직접적으로 활용되는 부분은 확인되지 않았습니다.

## 🛡️ 보안

-   **비밀번호 해싱**: 사용자 비밀번호는 `werkzeug.security`를 사용하여 안전하게 해싱되어 저장됩니다.
-   **세션 관리**: `Flask-Login`을 통해 사용자 세션이 안전하게 관리되며, `login_required` 데코레이터를 사용하여 보호된 라우트에 대한 접근을 제한합니다.
-   **로그인 잠금**: 무차별 대입 공격을 방지하기 위해 5회 로그인 실패 시 계정이 15분 동안 잠금 처리됩니다.
-   **관리자 접근 제어**: `admin_required` 데코레이터를 사용하여 관리자 기능에 대한 접근을 제한합니다.
-   **데이터 보호**: 모든 사용자 데이터는 로컬 `sns.db` 파일에 저장되며, 외부 서버로 전송되지 않습니다.
-   **SQLAlchemy ORM**: ORM 사용을 통해 일반적인 SQL 인젝션 취약점을 방지합니다.

## 🐛 문제 해결

### 포트 충돌
-   기본 포트 5001을 사용하며, 해당 포트가 사용 중일 경우 자동으로 다른 사용 가능한 포트를 찾아 실행됩니다.

### 데이터베이스 오류
-   `sns.db` 파일에 문제가 발생하면, `instance` 폴더 전체를 삭제한 후 앱을 재실행하여 데이터베이스를 초기화할 수 있습니다. **이 경우 모든 게시물과 계정 정보가 삭제됩니다.**

### PyInstaller 빌드 실행 파일 문제 (데이터 지속성, 템플릿 로딩)
-   `FlaskSNS.exe` 실행 시 데이터가 유지되지 않거나 (`sqlite3.OperationalError`), 템플릿을 찾지 못하는 (`TemplateNotFound`) 문제가 발생할 경우, 이는 PyInstaller 빌드 환경에서 Flask의 경로 설정 문제일 가능성이 높습니다.
-   위의 "PyInstaller 빌드 및 포터블 실행 파일 생성" 섹션을 참조하여 `app.py`의 경로 설정 로직과 PyInstaller 빌드 명령이 올바르게 적용되었는지 확인하십시오.

## 📞 지원

문제가 발생하거나 질문이 있다면, GitHub 이슈 트래커를 통해 문의해주세요.

## 📄 라이선스

MIT License

---

**Flask SNS 포터블 앱** - 나만의 소셜 네트워크를 USB에 담아가세요! 💾✨
